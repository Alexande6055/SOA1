<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lista de Estudiantes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center mb-4">Lista de Estudiantes</h1>

    <!-- Campo de búsqueda de cédula -->
    <div class="d-flex mb-4">
        <input type="text" id="cedulaBuscar" class="form-control me-2" placeholder="Buscar por cédula" />
        <button id="buscarBtn" class="btn btn-primary">Buscar</button>
        <button id="refrescarBtn" class="btn btn-secondary ms-2">Refrescar</button>

    </div>

    <!-- Botón para agregar estudiante -->
    <div class="text-end mb-3">
        <a href="/estudiantes/nuevo" class="btn btn-primary">Agregar Estudiante</a>
    </div>

    <!-- Tabla de estudiantes -->
    <table class="table table-bordered table-hover" id="tablaEstudiantes">
        <thead class="table-dark">
        <tr>
            <th>Cédula</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Dirección</th>
            <th>Teléfono</th>
            <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        <!-- Los datos de estudiantes se llenarán aquí -->
        </tbody>
    </table>
</div>

<script>
    // Función para realizar la búsqueda por cédula
     $(document).ready(function() {

         // Cargar todos los estudiantes al cargar la página
         cargarEstudiantes();

         // Acción de búsqueda
         $('#buscarBtn').click(function() {
             var cedula = $('#cedulaBuscar').val(); // Obtener la cédula ingresada
             if (cedula) {
                 // Realizar la solicitud AJAX a la API para buscar por cédula
                 $.get('http://localhost:8080/Apiestudiantes/buscar', { cedula: cedula }, function(data) {
                     // Limpiar la tabla antes de agregar los resultados
                     $('#tablaEstudiantes tbody').empty();

                     // Verificar si se recibió un objeto con los datos del estudiante
                     if (data && data.cedula) {
                         // Agregar el estudiante a la tabla
                         var fila = '<tr>' +
                             '<td>' + data.cedula + '</td>' +
                             '<td>' + data.nombre + '</td>' +
                             '<td>' + data.apellido + '</td>' +
                             '<td>' + data.direccion + '</td>' +
                             '<td>' + data.telefono + '</td>' +
                             '<td>' +
                                 '<a href="/estudiantes/editar/' + data.cedula + '" class="btn btn-warning btn-sm">Editar</a>' +
                                 '<a href="/estudiantes/eliminar/' + data.cedula + '" class="btn btn-danger btn-sm">Eliminar</a>' +
                             '</td>' +
                         '</tr>';
                         $('#tablaEstudiantes tbody').append(fila);
                     } else {
                         // Si no se encuentra el estudiante, mostrar un mensaje en la tabla
                         $('#tablaEstudiantes tbody').append('<tr><td colspan="6" class="text-center">No se encontraron resultados</td></tr>');
                     }
                 }).fail(function() {
                     alert('Error al buscar el estudiante.');
                 });
             } else {
                 // Si no se ha ingresado cédula, alertar al usuario
                 alert('Por favor ingrese una cédula para buscar.');
             }
         });

         // Acción de refrescar (cargar todos los estudiantes)
         $('#refrescarBtn').click(function() {
             cargarEstudiantes();
         });

         // Función para cargar todos los estudiantes desde la API
         function cargarEstudiantes() {
             $.get('http://localhost:8080/Apiestudiantes', function(data) {
                 // Limpiar la tabla antes de agregar los resultados
                 $('#tablaEstudiantes tbody').empty();

                 // Verificar si se recibió un array de estudiantes
                 if (data && data.length > 0) {
                     // Agregar cada estudiante a la tabla
                     data.forEach(function(estudiante) {
                         var fila = '<tr>' +
                             '<td>' + estudiante.cedula + '</td>' +
                             '<td>' + estudiante.nombre + '</td>' +
                             '<td>' + estudiante.apellido + '</td>' +
                             '<td>' + estudiante.direccion + '</td>' +
                             '<td>' + estudiante.telefono + '</td>' +
                             '<td>' +
                                 '<a href="/estudiantes/editar/' + estudiante.cedula + '" class="btn btn-warning btn-sm">Editar</a>' +
                                 '<a href="/estudiantes/eliminar/' + estudiante.cedula + '" class="btn btn-danger btn-sm">Eliminar</a>' +
                             '</td>' +
                         '</tr>';
                         $('#tablaEstudiantes tbody').append(fila);
                     });
                 } else {
                     // Si no se encuentran estudiantes, mostrar mensaje
                     $('#tablaEstudiantes tbody').append('<tr><td colspan="6" class="text-center">No hay estudiantes registrados</td></tr>');
                 }
             }).fail(function() {
                 alert('Error al cargar los estudiantes.');
             });
         }
     });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
